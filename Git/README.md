# Git 

版本管理程序，拥有 **工作区**、**暂存区**、**远程仓库** 三颗进度树，当前的仓库即是工作区，只有先将工作区的所有文件存进暂存区形成一个版本快照，并且使得当前工作区“干净”才能将暂存区里的快照推入远程仓库保存代码。

[参考手册1](https://www.yiibai.com/git)

[参考手册2](https://git-scm.com/book/zh/v2)

## 首次使用

- **配置用户名和邮箱**

  ```
  git config --global user.name "用户名"
  git config --global user.email "邮箱"
  ```

## 基础操作

- **初始化仓库**

  进入仓库目录，使用 `git init` 命令，会在当前目录下生成一个隐藏的 `.git` 文件夹。

- **添加文件到缓存区**

  使用  `git add .` 命令将所有已修改文件添加入缓存区，可以使用具体文件名替换 “.” 来添加指定文件。

- **添加提交说明**

  `git commit -m "信息"`，只有先添加提交说明才能把本次提交上传至 Github。

- **查看工作区状态**

  `git status`，只有工作树是干净的时候才能执行上传操作。

- **查看历史提交**

  `git log`，可以查看历史提交数目与详细信息，包含本次提交的版本的 ID。

- **版本回滚**

  `git reset`，将暂存区回滚至指定版本，后面可以加版本 ID 前几位或者 `HEAD~`，波浪线数量或者波浪线后加数字表示回滚到 HEAD 前的第几个版本，`HEAD~` 表示回滚到上一个版本。

  `git reset --hard HEAD~` 会将当前的工作区一起回滚，若当前工作区没有保存则会完全丢失，小心使用。

- **查看改动**

  `git diff` 可查看工作区与缓存区中间的不同之处。

- **修改提交说明**

  `git commit --amend` 会进入 vim 的修改模式，然后修改最后一次的提交说明。

  `git commit --amend -m "新的说明"` 会直接覆盖最后一次提交的提交说明。

- **文件恢复**

  再添加入暂存区后不小心删除了本地的文件，可以从暂存区直接恢复回来，使用 `git checkout -- <file>` 命令。

- **删除文件**

  `git rm <file>` 可以删除工作区和暂存区的文件，取消文件跟踪，在下次提交不被纳入版本管理中，但是被删除的文件依然在提交记录中。

  删除文件之后使用 `git reset --soft HEAD~` 可以将记录指针指向上一个快照版本。

  当工作区与暂存区的文件存在差异时：

  `git rm -f <file>` 同时删除工作区与暂存区的文件。

  `git rm --cached <file>` 只删除暂存区的文件。

- **修改文件名**

  `git mv <oldname> <newname>` 可以修改文件名。

## 分支

- **创建分支**

  `git branch <分支名称>` 可以创建新的分支，HEAD 仍指向原来的分支。

  `git checkout -b <分支名称>` 可以创建并切换至新分支。

- **切换分支**

  `git checkout <分支名>` 可以切换至已存在的分支。

- **查看分支**

  `git branch` 可以查看本地的分支。

  `git branch -a` 可以查看所有分支，包括远程分支。

- **显示分支状态**

  `git log --decorate --oneline --graph --all` 可以以简单的图形化界面显示出当前的分支树。

- **合并分支**

  先切换到合并目标分支。

  `git merge <被合并分支>` 可以将其他分支合并至当前的分支。

- **删除分支**

  `git branch -d <分支名称>` 可以删除已存在的分支。

- **匿名分支**

  `git branch <HEAD~ | 快照 ID>` 可以创建匿名分支（HEAD 不指向任何分支，处于离线状态），对匿名分支的操作不会影响其他分支，可以用来做一些有风险的实验。当分支从匿名分支切换至其他分支时，匿名分支的修改将会被丢弃。

  处于匿名分支时可以使用 `git checkout -b <分支名称>` 保存当前的匿名分支。

## 远程仓库

- **获取远程更新（Fetch）**

  更新远程追踪分支：`git fetch <远程主机名>`

  更新指定分支：`git fetch <远程主机名> <远程分支>`

  更新所有分支可简写为：`git fetch`

- **拉取（Pull）**

  `git pull <远程主机名> <远程分支名>:<本地分支名>` 可以拉取远程分支并与本地分支进行整合。

  比如要取回 `origin` 远程主机的 `next` 分支与本地的 `master` 分支合并：

  `git pull origin next:master`

  若只需要与本地当前分支合并则可省略冒号后面的。

  如果本地与远程主机只有1个追踪分支，只需要 `git pull` 即可。

- **推送（Push）**

  `git push <远程主机名> <本地分支名>:<远程分支名>`

  若本地分支与远程分支同名可省略冒号后面的内容，若远程分支不存在，则创建，默认与本地分支名相同。

  当只有一个远程追踪时可简写为：`git push`

  若有当前分支与多个远程主机绑定追踪时，可指定默认追踪：

  `git push -u <远程主机名> <远程分支名>`

  不管是否存在远程分支都进行推送：

  `git push --all <远程主机名>`

- **远程分支**

  如果通过 `clone` 命令克隆的仓库，会默认将本地的 `master` 分支与远程的 `origin/master` 分支绑定追踪。

  手动绑定追踪：

  `git branch --set-upstream <本地分支> <远程主机名/远程分支>`

  在远程分支的基础上创建本地分支：

  `git checkout -b <本地分支名> <远程主机名/远程分支>`

  删除远程分支：

  `git push <远程主机名> :<远程分支名>`，例如：`git push oringin :test1`

  `git push <远程主机名> -d <远程分支名>`

## 多人合作

- **获取远程更新（Fetch）**

  多人协作时，出于安全考虑，成员无法直接推送至远程的 master 或者 dev 等重要分支，需要在本地建立自己的分支，将自己的分支推送至远程后，提出合并请求，才能将自己的代码合并至 master 或者 dev 分支。

  `clone` 一个项目之后，通过使用 `git checkout -b 本地分支名 origin/dev` 从远程的 dev 分支新建一个本地分支，并将本地分支与远程的 dev 分支绑定追踪关系。

  添加、修改完本地分支之后使用 `git pull origin 本地分支` 命令将最新的 dev 分支与本地分支合并，完成合并后再使用 `git push origin 本地分支名:远程分支名` 将本地分支推送至相应的远程分支，最后提交合并请求即可。
